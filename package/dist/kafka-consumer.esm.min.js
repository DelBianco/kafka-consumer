import{Kafka as t}from"kafkajs";let e=[];async function i(i){const a=new t({clientId:i.clientId,brokers:i.brokers}),s=a.consumer({groupId:i.groupId});a.admin();let n=10;setInterval((()=>{n-=1}),1e3);let r=await this.kafkaAdmin.listTopics();r=r.filter((t=>"__"!==t.substring(0,2))),r.forEach((t=>{this.buffer?.push({topic:t,buffer:[]})}));try{await s.connect(),await s.subscribe({topics:r,fromBeginning:!0}),await s.run({eachMessage:async({topic:t,partition:i,message:a,pause:s})=>{if(function(t,i,a){e.filter((e=>e.topic===t)).map((e=>(e.buffer.push({topic:t,message:i,partition:a}),10>=e.buffer.length&&e.buffer.shift(),e)))}(t,`${a.value}`,i),0===n)throw s(),new DOMException("timeout")}})}catch(t){await s.disconnect()}}export{i as default};
