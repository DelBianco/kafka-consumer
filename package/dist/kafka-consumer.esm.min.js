const t=require("kafkajs");let e=[];async function i(i){const a=new t.Kafka({clientId:i.clientId,brokers:i.brokers}),n=a.consumer({groupId:i.groupId}),s=a.admin();let o=30;setInterval((()=>{o-=1}),1e3);let r=await s.listTopics();await s.disconnect(),r=r.filter((t=>"__"!==t.substring(0,2))),r.forEach((t=>{e?.push({topic:t,buffer:[]})}));try{await n.connect(),await n.subscribe({topics:r,fromBeginning:!0}),await n.run({eachMessage:async({topic:t,partition:i,message:a,pause:n})=>{if(function(t,i,a){e.filter((e=>e.topic===t)).map((e=>(e.buffer.push({topic:t,message:i,partition:a}),10>=e.buffer.length&&e.buffer.shift(),e)))}(t,`${a.value}`,i),0===o)throw n(),new Error("timeout")}})}catch(t){console.log(t)}await n.disconnect()}export{i as default};
